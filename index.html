<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>LinkedIn to JSON Resume</title>
        <meta name="description" content="A web site to export your LinkedIn profile to JSON Resume format">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
        body {
        	font-family: FreeSans, Arimo,"Droid Sans",Helvetica,Arial,sans-serif;
        	padding: 20px;
        	max-width: 500px;
        	margin: 0 auto;
        	text-align: center;
        }
        textarea {
        	width: 100%;
        	height: 200px;
        }

        .IN-widget {
        	margin: 0 auto;
        	padding: 10px;
        }
        </style>
		<!-- see https://developer.linkedin.com/documents/javascript-api-tutorial -->
	</head>
	<body>
		<h1>LinkedIn to Json Résumé</h1>
		<p>This is a small website that exports your LinkedIn profile to a <a href="http://jsonresume.org/">JSON Résumé</a>.</p>
		<p>Log in with your LinkedIn account:</p>
		<script type="IN/Login"></script>
		<textarea id="output" placeholder="Here you will see the exported JSON"></textarea>
		
		<script>
		var linkedinToJsonResume = function(profile) {

			var bio = {
				firstName: profile.firstName,
				lastName: profile.lastName,
				email: {
					personal: profile.emailAddress
				},
				phone: { },
				summary: profile.summary,
				location: {
					city: profile.location.name,
					countryCode: profile.location.country.code.toUpperCase()
				}
			};

			var work = profile.positions.values.map(function(p) {

				var object = {
					company: p.company.name,
					position: p.title,
					startDate: p.startDate.year + '-' + (p.startDate.month < 10 ? '0' : '') + p.startDate.month,
					summary: p.summary
				};

				if (p.endDate) {
					object.endDate = p.endDate.year + '-' + (p.endDate.month < 10 ? '0' : '') + p.endDate.month;
				}

				return object;
			});

			var education = profile.educations.values.map(function(e) {
				return {
					institution: e.schoolName,
					startDate: '' + e.startDate.year,
					endDate: '' + e.endDate.year,
					area: e.fieldOfStudy,
					summary: e.notes,
					studyType: e.degree,
					courses: []	// even though they are returned through the API, they can't
								// be tracked back to a school/education entry
				};
			});

			var skills = profile.skills.values.map(function(s) {
				return {
					name: s.skill.name,
					keywords: []
				};
			});

			var references = profile.recommendationsReceived.values.map(function(r) {
					return {
						name: r.recommender.firstName + ' ' + r.recommender.lastName,
						reference: r.recommendationText
					};
			});

			var allData = {
				bio: bio,
				work: work,
				education: education,
				skills: skills,
				references: references
			}

			document.getElementById('output').value = JSON.stringify(allData, undefined, 2);
		}

		var onLinkedInAuth = function() {
			IN.API.Profile("me")
				.fields("firstName", "lastName", "industry", "summary", "specialties",
					"positions", "email-address", "languages", "skills", "educations",
					"location:(name,country)", "recommendations-received")
    			.result(function(data) {
    				linkedinToJsonResume(data.values[0]);
	    		});
		};

		var onLinkedInLoad = function() {
			IN.Event.on(IN, "auth", onLinkedInAuth);
		};
		</script>
		<script type="text/javascript" src="http://platform.linkedin.com/in.js">
  			api_key: 77dswa2ycddelm
			onLoad: onLinkedInLoad
  			authorize: true
		</script>
		<script type="text/javascript">
		    var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-39254352-1"]);_gaq.push(["_trackPageview"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src="http://www.google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})()
		</script>
	</body>
</html>